<?xml version="1.0"?>
<OperationAbstraction xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://tempuri.org/Operation_v1_0.xsd">
  <Operations codeNamespace="TheBall.Payments">
    <Operation name="ProcessPayment">
      <OperationSpec>
        <Description>Process Stripe payment</Description>
      </OperationSpec>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="PaymentToken" dataType="INT.PaymentToken" designDesc="Obtain Stripe Token from request stream" state="implemented" />
          <MethodExecute name="ValidateMatchingEmail" designDesc="Validate that account active email matches payment token email" state="implemented">
            <Target name="PaymentToken" />
          </MethodExecute>
          <TargetDefinition name="CustomerAccount" dataType="CustomerAccount" designDesc="Customer account object based on active account ID. Created if missing" state="implemented" />
          <MethodExecute name="ProcessPayment" designDesc="Process payment to Stripe" state="implemented">
            <Target name="PaymentToken" />
            <Target name="CustomerAccount" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="FetchCustomersFromStripe">
      <OperationSpec>
        <Description>Fetch customers from Stripe</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="GroupID" dataType="string" designDesc="Group ID to fetch the customers to" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="Owner" dataType="TheBall.CORE.IContainerOwner" designDesc="Validate group ID as valid Payments managing group" state="implemented">
            <Parameter name="GroupID" />
          </TargetDefinition>
          <TargetDefinition name="StripeCustomers" dataType="Stripe.StripeCustomer[]" designDesc="Stripe customers from service call" state="implemented" />
          <TargetDefinition name="CurrentCustomers" dataType="CustomerAccountCollection" designDesc="Current customer collection" state="implemented">
            <Target name="Owner" />
          </TargetDefinition>
          <TargetDefinition name="NewCustomersToCreate" dataType="CustomerAccount[]" designDesc="New customers to create" state="implemented">
            <Target name="Owner" />
            <Target name="StripeCustomers" />
            <Target name="CurrentCustomers" />
          </TargetDefinition>
          <MethodExecute name="StoreObjects" designDesc="Store new customers" state="implemented">
            <Target name="Owner" />
            <Target name="NewCustomersToCreate" />
          </MethodExecute>
        </SequentialExecution>
      </Execution>
    </Operation>
    <Operation name="AssociatePaymentToGroup">
      <OperationSpec>
        <Description>Associate payment to group</Description>
      </OperationSpec>
      <Parameters>
        <Parameter name="GroupID" dataType="string" designDesc="ID of the group to associate the payment to" state="implemented" />
        <Parameter name="PaymentID" dataType="string" designDesc="ID of the payment to connect to group" state="implemented" />
      </Parameters>
      <Execution>
        <SequentialExecution>
          <TargetDefinition name="GroupAsOwner" dataType="TheBall.CORE.IContainerOwner" designDesc="Group as owner" state="implemented">
            <Parameter name="GroupID" />
          </TargetDefinition>
        </SequentialExecution>
      </Execution>
    </Operation>
  </Operations>
</OperationAbstraction>