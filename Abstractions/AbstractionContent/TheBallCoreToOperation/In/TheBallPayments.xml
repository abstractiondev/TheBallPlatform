<?xml version="1.0" encoding="utf-8"?>
<TheBallCoreAbstraction xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="TheBallCore_v1_0.xsd">
  <InstanceOfTheBall semanticDomainName="TheBall.Payments">
    <DigitalInterface>
      <InterfaceModel>
        <InterfaceObject name="PaymentToken" designDesc="Payment authorized token">
          <InterfaceItems>
            <InterfaceItem name="id" logicalDataType="Text_Short"/>
            <InterfaceItem name="currentproduct" logicalDataType="Text_Short"/>
            <InterfaceItem name="email" logicalDataType="Text_Short"/>
          </InterfaceItems>
        </InterfaceObject>
      </InterfaceModel>
    </DigitalInterface>
    <InformationModel>
      <!--
      <InformationObject name="Payment" designDesc="Payment object">
        
      </InformationObject>
      -->
      <InformationObject name="PaymentItem" designDesc="Generic purchaseable item">
        <InformationItems>
          <InformationItem name="TargetItemDomain" logicalDataType="Text_Short"/>
          <InformationItem name="TargetItemName" logicalDataType="Text_Short"/>
          <InformationItem name="TargetItemID" logicalDataType="Text_Short"/>
          <InformationItem name="ItemType" logicalDataType="Text_Short"/>
          <InformationItem name="ItemTypeID" logicalDataType="Text_Short"/>
          <InformationItem name="Price" logicalDataType="Text_Short"/>
          <InformationItem name="Currency" logicalDataType="Text_Short"/>
          <InformationItem name="BillingInterval" logicalDataType="Text_Short"/>
        </InformationItems>
      </InformationObject>
      <InformationObject name="CustomerAccountCollection" designDesc="Collection of customer accounts">
        <CollectionFor collectionType="Master" contentInformationObjectName="CustomerAccount"/>
      </InformationObject>
      <InformationObject name="CustomerAccount" designDesc="Payment identified customer, ID based on account">
        <InformationItems>
          <InformationItem name="StripeID" logicalDataType="Text_Short"/>
          <InformationItem name="EmailAddress" logicalDataType="Text_Short"/>
          <InformationItem name="Description" logicalDataType="Text_Short"/>
        </InformationItems>
      </InformationObject>
    </InformationModel>
    <Operations>
      <Operation name="ProcessPayment">
        <OperationSpec>
          <Description>Process Stripe payment</Description>
        </OperationSpec>
        <Execution>
          <SequentialExecution>
            <TargetDefinition dataType="INT.PaymentToken" name="PaymentToken" designDesc="Obtain Stripe Token from request stream" state="implemented" />
            <MethodExecute name="ValidateMatchingEmail" designDesc="Validate that account active email matches payment token email" state="implemented">
              <Target name="PaymentToken"/>
            </MethodExecute>
            <TargetDefinition dataType="CustomerAccount" name="CustomerAccount" designDesc="Customer account object based on active account ID. Created if missing" state="implemented" />
            <MethodExecute name="ProcessPayment" designDesc="Process payment to Stripe" state="implemented">
              <Target name="PaymentToken"/>
              <Target name="CustomerAccount"/>
            </MethodExecute>
          </SequentialExecution>
        </Execution>
      </Operation>
      <Operation name="FetchCustomersFromStripe">
        <OperationSpec>
          <Description>Fetch customers from Stripe</Description>
        </OperationSpec>
        <Parameters>
          <Parameter name="GroupID" dataType="string" designDesc="Group ID to fetch the customers to" state="implemented"/>
        </Parameters>
        <Execution>
          <SequentialExecution>
            <TargetDefinition dataType="TheBall.CORE.IContainerOwner" designDesc="Validate group ID as valid Payments managing group" name="Owner" state="implemented">
              <Parameter name="GroupID"/>
            </TargetDefinition>
            <TargetDefinition name="StripeCustomers" dataType="Stripe.StripeCustomer[]" designDesc="Stripe customers from service call" state="implemented" />
            <TargetDefinition name="CurrentCustomers" dataType="CustomerAccountCollection" designDesc="Current customer collection" state="implemented">
              <Target name="Owner"/>
            </TargetDefinition>
            <TargetDefinition name="NewCustomersToCreate" dataType="CustomerAccount[]" designDesc="New customers to create" state="implemented">
              <Target name="Owner"/>
              <Target name="StripeCustomers"/>
              <Target name="CurrentCustomers"/>
            </TargetDefinition>
            <MethodExecute name="StoreObjects" designDesc="Store new customers" state="implemented">
              <Target name="Owner"/>
              <Target name="NewCustomersToCreate"/>
            </MethodExecute>
          </SequentialExecution>
        </Execution>
      </Operation>
      <Operation name="AssociatePaymentToGroup">
        <OperationSpec>
          <Description>Associate payment to group</Description>
        </OperationSpec>
        <Parameters>
          <Parameter name="GroupID" dataType="string" designDesc="ID of the group to associate the payment to" state="implemented"/>
          <Parameter name="PaymentID" dataType="string" designDesc="ID of the payment to connect to group" state="implemented"/>
        </Parameters>
        <Execution>
          <SequentialExecution>
            <TargetDefinition name="GroupAsOwner" dataType="TheBall.CORE.IContainerOwner" designDesc="Group as owner" state="implemented">
              <Parameter name="GroupID"/>
            </TargetDefinition>
          </SequentialExecution>
        </Execution>
      </Operation>
    </Operations>
    
    <!--
    <Subscriptions />
    -->
  </InstanceOfTheBall>
</TheBallCoreAbstraction>